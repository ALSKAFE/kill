<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙ‚ÙˆÙŠÙ… Ø­Ø¬Ø² Ø§Ù„Ø´Ø§Ù„ÙŠÙ‡</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
</head>
<body class="bg-gray-100 text-right" dir="rtl">

  <div class="max-w-2xl mx-auto mt-8 p-6 bg-white rounded-2xl shadow-xl">
    <div class="flex justify-between items-center mb-4">
      <button onclick="changeMonth(-1)" class="text-blue-500 font-bold">âŸ¨</button>
      <h2 id="monthLabel" class="text-lg font-bold"></h2>
      <button onclick="changeMonth(1)" class="text-blue-500 font-bold">âŸ©</button>
    </div>

    <div class="grid grid-cols-7 gap-1 text-center text-xs font-semibold text-gray-600 mb-2">
      <div>Ø£Ø­Ø¯</div><div>Ø¥Ø«Ù†ÙŠÙ†</div><div>Ø«Ù„Ø§Ø«Ø§Ø¡</div><div>Ø£Ø±Ø¨Ø¹Ø§Ø¡</div><div>Ø®Ù…ÙŠØ³</div><div>Ø¬Ù…Ø¹Ø©</div><div>Ø³Ø¨Øª</div>
    </div>

    <div id="calendarGrid" class="grid grid-cols-7 gap-1"></div>
  </div>

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ -->
  <div id="bookingForm" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
    <div class="bg-white p-6 rounded-lg w-96 shadow-lg">
      <h2 id="formTitle" class="text-lg font-bold mb-4">Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²</h2>
      <label class="block mb-2">Ø§Ù„ÙØªØ±Ø©:
        <select id="period" class="w-full border p-2 rounded">
          <option value="morning">ØµØ¨Ø§Ø­ÙŠØ©</option>
          <option value="evening">Ù…Ø³Ø§Ø¦ÙŠØ©</option>
          <option value="both">ÙƒÙ„Ø§Ù‡Ù…Ø§</option>
        </select>
      </label>
      <label class="block mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:
        <input id="name" class="w-full border p-2 rounded" type="text" />
      </label>
      <label class="block mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:
        <input id="phone" class="w-full border p-2 rounded" type="text" />
      </label>
      <label class="block mb-2">Ø§Ù„Ù…Ø¯ÙÙˆØ¹:
        <input id="paid" class="w-full border p-2 rounded" type="number" />
      </label>
      <label class="block mb-2">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:
        <input id="rest" class="w-full border p-2 rounded" type="number" />
      </label>
      <label class="block mb-4">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ:
        <input id="people" class="w-full border p-2 rounded" type="number" />
      </label>
      <div id="newBookingButtons" class="flex justify-between">
        <button onclick="saveBooking()" class="bg-blue-500 text-white px-4 py-2 rounded">Ø­ÙØ¸</button>
        <button onclick="closeForm()" class="text-red-500">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
      <div id="viewBookingButtons" class="flex justify-between hidden">
        <button onclick="closeForm()" class="bg-blue-500 text-white px-4 py-2 rounded">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
  
  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø² -->
  <div id="viewBookingForm" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
    <div class="bg-white p-6 rounded-lg w-96 shadow-lg">
      <h2 class="text-lg font-bold mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø²</h2>
      <div class="mb-2"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span id="viewDate"></span></div>
      <div class="mb-2"><strong>Ø§Ù„ÙØªØ±Ø©:</strong> <span id="viewPeriod"></span></div>
      <div class="mb-2"><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</strong> <span id="viewName"></span></div>
      <div class="mb-2"><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span id="viewPhone"></span></div>
      <div class="mb-2"><strong>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</strong> <span id="viewPaid"></span></div>
      <div class="mb-2"><strong>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> <span id="viewRemaining"></span></div>
      <div class="mb-4"><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ:</strong> <span id="viewPeople"></span></div>
      <div class="flex justify-center">
        <button onclick="closeViewForm()" class="bg-blue-500 text-white px-4 py-2 rounded">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
  
  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø© -->
  <div id="periodSelectorForm" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
    <div class="bg-white p-6 rounded-lg w-96 shadow-lg">
      <h2 class="text-lg font-bold mb-4">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©</h2>
      <div id="dateDisplay" class="mb-4 text-center font-bold"></div>
      
      <div class="grid grid-cols-1 gap-4">
        <button id="morningBtn" onclick="handlePeriodSelect('morning')" class="bg-blue-500 text-white px-4 py-6 rounded text-lg">
          Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© â˜€ï¸
        </button>
        
        <button id="eveningBtn" onclick="handlePeriodSelect('evening')" class="bg-purple-500 text-white px-4 py-6 rounded text-lg">
          Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© ğŸŒ™
        </button>
        
        <button id="bothBtn" onclick="handlePeriodSelect('both')" class="bg-green-500 text-white px-4 py-6 rounded text-lg">
          Ø§Ù„ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ â˜€ï¸ğŸŒ™
        </button>
      </div>
      
      <div class="mt-4 text-center">
        <button onclick="closePeriodSelector()" class="text-red-500">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <script>
    const DateTime = luxon.DateTime;
    let current = DateTime.local();
    let selectedDate = null;
    const bookings = <%- bookings %>;

    function renderCalendar() {
      const monthLabel = document.getElementById("monthLabel");
      const calendarGrid = document.getElementById("calendarGrid");
      calendarGrid.innerHTML = "";

      const startOfMonth = current.startOf("month");
      const daysInMonth = current.daysInMonth;
      const firstWeekday = startOfMonth.weekday % 7;

      // Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³Ù…Ù‡
      monthLabel.textContent = current.toFormat("M/yyyy");

      for (let i = 0; i < firstWeekday; i++) {
        calendarGrid.innerHTML += `<div></div>`;
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const fullDate = current.set({ day }).toISODate();
        const data = bookings[fullDate] || {};

        let bgColor = "bg-white";
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø¨Ø¹
        let onclick;
        if (data.morning || data.evening) {
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø­Ø¬Ø² ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŒ Ù†Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
          onclick = `showBookingOptions('${fullDate}')`;
        } else {
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹ ÙØ§Ø±ØºÙ‹Ø§ØŒ Ù†Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø© Ù„Ù„Ø­Ø¬Ø²
          onclick = `showPeriodSelector('${fullDate}')`;
        }
        
        // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
        if (data.morning && data.evening) {
          bgColor = "bg-green-600"; // Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚ Ù„Ù„ÙØªØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        } else if (data.morning || data.evening) {
          bgColor = "bg-green-200"; // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ù„ÙØªØ±Ø© ÙˆØ§Ø­Ø¯Ø©
        }

        // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©
        const textColor = bgColor === "bg-green-600" ? "text-white" : "text-black";
        
        calendarGrid.innerHTML += `
          <div class="p-1 rounded-lg ${bgColor} ${textColor} text-xs hover:bg-yellow-100 hover:text-black cursor-pointer border" onclick="${onclick}">
            <div class="font-bold text-sm">${day}</div>
            <div class="mt-1">
              ${data.morning ? 'â˜€ï¸' : ''} ${data.evening ? 'ğŸŒ™' : ''}
            </div>
          </div>
        `;
      }
    }

    function changeMonth(delta) {
      current = current.plus({ months: delta });
      renderCalendar();
    }

    // ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯
    function openNewBookingForm(date, periodType = "morning") {
      selectedDate = date;
      
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„
      document.getElementById("formTitle").textContent = "Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²";
      document.getElementById("period").value = periodType; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      document.getElementById("name").value = "";
      document.getElementById("phone").value = "";
      document.getElementById("paid").value = "";
      document.getElementById("rest").value = "";
      document.getElementById("people").value = "";
      
      // ØªÙØ¹ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      document.getElementById("period").disabled = false;
      document.getElementById("name").disabled = false;
      document.getElementById("phone").disabled = false;
      document.getElementById("paid").disabled = false;
      document.getElementById("rest").disabled = false;
      document.getElementById("people").disabled = false;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡
      document.getElementById("newBookingButtons").classList.remove("hidden");
      document.getElementById("viewBookingButtons").classList.add("hidden");
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      document.getElementById("bookingForm").classList.remove("hidden");
    }

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
    function showPeriodSelector(date) {
      selectedDate = date;
      const data = bookings[date] || {};
      
      // Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨ØªÙ†Ø³ÙŠÙ‚ Ø¬Ù…ÙŠÙ„
      document.getElementById("dateDisplay").textContent = formatDate(date);
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØªØ±Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      const morningBtn = document.getElementById("morningBtn");
      const eveningBtn = document.getElementById("eveningBtn");
      const bothBtn = document.getElementById("bothBtn");
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      morningBtn.disabled = false;
      morningBtn.classList.remove("opacity-50", "cursor-not-allowed");
      morningBtn.textContent = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© â˜€ï¸";
      
      eveningBtn.disabled = false;
      eveningBtn.classList.remove("opacity-50", "cursor-not-allowed");
      eveningBtn.textContent = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© ğŸŒ™";
      
      bothBtn.disabled = false;
      bothBtn.classList.remove("opacity-50", "cursor-not-allowed");
      bothBtn.textContent = "Ø§Ù„ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ â˜€ï¸ğŸŒ™";
      
      // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ
      if (data.morning) {
        morningBtn.disabled = true;
        morningBtn.classList.add("opacity-50", "cursor-not-allowed");
        morningBtn.textContent = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© â˜€ï¸ (Ù…Ø­Ø¬ÙˆØ²Ø©)";
        bothBtn.disabled = true;
        bothBtn.classList.add("opacity-50", "cursor-not-allowed");
      }
      
      if (data.evening) {
        eveningBtn.disabled = true;
        eveningBtn.classList.add("opacity-50", "cursor-not-allowed");
        eveningBtn.textContent = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© ğŸŒ™ (Ù…Ø­Ø¬ÙˆØ²Ø©)";
        bothBtn.disabled = true;
        bothBtn.classList.add("opacity-50", "cursor-not-allowed");
      }
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
      document.getElementById("periodSelectorForm").classList.remove("hidden");
    }
    
    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
    function handlePeriodSelect(periodType) {
      const date = selectedDate;
      const data = bookings[date] || {};
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØªØ±Ø© Ù…Ø­Ø¬ÙˆØ²Ø©
      if ((periodType === 'morning' && data.morning) || 
          (periodType === 'evening' && data.evening) || 
          (periodType === 'both' && (data.morning || data.evening))) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØªØ±Ø© Ù…Ø­Ø¬ÙˆØ²Ø©ØŒ Ù†Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø²
        showBookingDetails(date, periodType);
      } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØªØ±Ø© ØºÙŠØ± Ù…Ø­Ø¬ÙˆØ²Ø©ØŒ Ù†ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯
        openNewBookingForm(date, periodType);
      }
      
      // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
      closePeriodSelector();
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù„Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø­Ø¬ÙˆØ² (ØµØ¨Ø§Ø­ÙŠØŒ Ù…Ø³Ø§Ø¦ÙŠØŒ ÙƒØ§Ù…Ù„)
    function showBookingOptions(date) {
      const data = bookings[date] || {};
      
      let html = `
        <div class="mb-4 text-center font-bold">${formatDate(date)}</div>
      `;
      
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ù„Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© ÙÙ‚Ø·
      if (data.morning) {
        html += `
          <div class="p-3 mb-3 bg-blue-100 rounded cursor-pointer" onclick="showBookingDetails('${date}', 'morning')">
            <div class="font-bold text-center">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© â˜€ï¸</div>
          </div>
        `;
      }
      
      if (data.evening) {
        html += `
          <div class="p-3 mb-3 bg-purple-100 rounded cursor-pointer" onclick="showBookingDetails('${date}', 'evening')">
            <div class="font-bold text-center">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© ğŸŒ™</div>
          </div>
        `;
      }
      
      // Ø®ÙŠØ§Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ ÙØªØ±Ø© Ù…ØªØ§Ø­Ø©
      if (!data.morning || !data.evening) {
        html += `
          <div class="p-3 mb-3 bg-green-100 rounded cursor-pointer" onclick="showPeriodSelector('${date}')">
            <div class="font-bold text-center">Ø¥Ø¶Ø§ÙØ© Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ +</div>
          </div>
        `;
      }
      
      html += `
        <div class="mt-4 text-center">
          <button onclick="closeOptionsForm()" class="text-red-500">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      `;
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
      const optionsFormContent = document.querySelector("#viewBookingForm .bg-white");
      const optionsTitle = optionsFormContent.querySelector("h2");
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰
      optionsFormContent.innerHTML = '';
      optionsFormContent.appendChild(optionsTitle);
      optionsTitle.textContent = 'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø¬Ø²';
      
      const contentDiv = document.createElement("div");
      contentDiv.innerHTML = html;
      optionsFormContent.appendChild(contentDiv);
      
      document.getElementById("viewBookingForm").classList.remove("hidden");
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    function closeOptionsForm() {
      document.getElementById("viewBookingForm").classList.add("hidden");
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
    function closePeriodSelector() {
      document.getElementById("periodSelectorForm").classList.add("hidden");
    }
    
    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²
    function showBookingDetails(date, periodType) {
      const data = bookings[date];
      let bookingData;
      let htmlContent = '';
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† periodType Ù‡Ùˆ 'both' ÙˆÙƒØ§Ù†Øª ÙƒÙ„ØªØ§ Ø§Ù„ÙØªØ±ØªÙŠÙ† Ù…Ø­Ø¬ÙˆØ²ØªÙŠÙ†ØŒ Ù†Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØªØ±ØªÙŠÙ† Ù…Ø¹Ù‹Ø§
      if (periodType === 'both' && data.morning && data.evening) {
        htmlContent = `
        <div class="mb-2 border-b pb-2"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDate(date)}</div>
        
        <div class="p-3 mb-3 bg-blue-100 rounded">
          <div class="font-bold mb-2">Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© â˜€ï¸</div>
          <div><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</strong> ${data.morning.tenantName}</div>
          <div><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${data.morning.phoneNumber}</div>
          <div><strong>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</strong> ${data.morning.paid}</div>
          <div><strong>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> ${data.morning.remaining}</div>
          <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ:</strong> ${data.morning.peopleCount}</div>
        </div>
        
        <div class="p-3 mb-3 bg-purple-100 rounded">
          <div class="font-bold mb-2">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© ğŸŒ™</div>
          <div><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</strong> ${data.evening.tenantName}</div>
          <div><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${data.evening.phoneNumber}</div>
          <div><strong>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</strong> ${data.evening.paid}</div>
          <div><strong>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> ${data.evening.remaining}</div>
          <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ:</strong> ${data.evening.peopleCount}</div>
        </div>
        `;
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø®ØµØµ
        const viewBookingContent = document.querySelector("#viewBookingForm .bg-white");
        const viewBookingTitle = viewBookingContent.querySelector("h2");
        const closeButton = document.createElement("div");
        closeButton.className = "flex justify-center mt-3";
        closeButton.innerHTML = '<button onclick="closeViewForm()" class="bg-blue-500 text-white px-4 py-2 rounded">Ø¥ØºÙ„Ø§Ù‚</button>';
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        viewBookingContent.innerHTML = '';
        viewBookingContent.appendChild(viewBookingTitle);
        viewBookingTitle.textContent = 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª';
        
        const contentDiv = document.createElement("div");
        contentDiv.innerHTML = htmlContent;
        viewBookingContent.appendChild(contentDiv);
        viewBookingContent.appendChild(closeButton);
        
        document.getElementById("viewBookingForm").classList.remove("hidden");
        return;
      }
      
      // ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ ÙØªØ±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù…Ø­Ø¬ÙˆØ²Ø© Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± ÙØªØ±Ø© Ù…Ø­Ø¯Ø¯Ø©
      if (periodType === 'morning') {
        bookingData = data.morning;
      } else if (periodType === 'evening') {
        bookingData = data.evening;
      } else if (periodType === 'both') {
        // Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± "both" Ù„ÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø­Ø¬Ø² ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²
        bookingData = data.morning || data.evening;
      }
      
      if (!bookingData) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²");
        return;
      }
      
      // Ù…Ù„Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¶
      document.getElementById("viewDate").textContent = formatDate(date);
      document.getElementById("viewPeriod").textContent = translatePeriod(periodType === 'both' ? (data.morning ? 'morning' : 'evening') : periodType);
      document.getElementById("viewName").textContent = bookingData.tenantName;
      document.getElementById("viewPhone").textContent = bookingData.phoneNumber;
      document.getElementById("viewPaid").textContent = bookingData.paid;
      document.getElementById("viewRemaining").textContent = bookingData.remaining;
      document.getElementById("viewPeople").textContent = bookingData.peopleCount;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ø±Ø¶
      document.getElementById("viewBookingForm").classList.remove("hidden");
    }
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø£Ø±Ù‚Ø§Ù…
    function formatDate(dateStr) {
      const date = DateTime.fromISO(dateStr);
      return date.toFormat("dd/M/yyyy");
    }
    
    // ØªØ±Ø¬Ù…Ø© Ù†ÙˆØ¹ Ø§Ù„ÙØªØ±Ø© Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
    function translatePeriod(period) {
      switch(period) {
        case 'morning': return 'ØµØ¨Ø§Ø­ÙŠØ©';
        case 'evening': return 'Ù…Ø³Ø§Ø¦ÙŠØ©';
        case 'both': return 'ÙƒØ§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…';
        default: return period;
      }
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ø±Ø¶
    function closeViewForm() {
      document.getElementById("viewBookingForm").classList.add("hidden");
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²
    function closeForm() {
      document.getElementById("bookingForm").classList.add("hidden");
    }

    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²
    function saveBooking() {
      const period = document.getElementById("period").value;
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const paid = document.getElementById("paid").value;
      const rest = document.getElementById("rest").value;
      const people = document.getElementById("people").value;

      if (!name || !phone) {
        alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
        return;
      }

      fetch('/api/save_booking', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          date: selectedDate, period, name, phone, paid, rest, people 
        })
      }).then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            closeForm();
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            window.location.reload();
          } else {
            alert(data.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø²");
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø²");
        });
    }

    // Initialize calendar
    renderCalendar(); 
  </script>

</body>
</html>